<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebXR with ARCore Geospatial</title>
    <script src="https://cdn.jsdelivr.net/npm/three@0.139.2/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.139.2/examples/jsm/webxr/ARButton.js"></script>
</head>
<body>
    <button id="startAR" style="position: fixed; top: 10px; left: 10px; z-index: 1000;">Start AR Experience</button>
    <script>
        let scene, camera, renderer, cube;

        async function initAR() {
            // Create the scene
            scene = new THREE.Scene();

            // Add camera
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            scene.add(camera);

            // Add WebGL renderer
            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.xr.enabled = true;
            document.body.appendChild(renderer.domElement);

            // Enable AR button
            document.body.appendChild(THREE.ARButton.createButton(renderer, {
                requiredFeatures: ["geo-tracking"],
            }));

            // Add a simple 3D object (a cube)
            const geometry = new THREE.BoxGeometry(0.2, 0.2, 0.2);
            const material = new THREE.MeshBasicMaterial({ color: 0xff0000 });
            cube = new THREE.Mesh(geometry, material);
            scene.add(cube);

            // Wait for AR session to start
            const session = await navigator.xr.requestSession("immersive-ar", {
                requiredFeatures: ["geo-tracking"],
            });

            // Attach session to renderer
            renderer.xr.setSession(session);

            // Use Geospatial API to set object position
            setGeospatialPosition(cube, 41.00439748963125, 28.934646817957);

            // Start rendering loop
            renderer.setAnimationLoop(() => {
                renderer.render(scene, camera);
            });
        }

        function setGeospatialPosition(object, latitude, longitude) {
            // Earth radius in meters
            const earthRadius = 6371e3;

            // Convert lat/lon to radians
            const latRad = (latitude * Math.PI) / 180;
            const lonRad = (longitude * Math.PI) / 180;

            // Calculate position on the globe
            const x = earthRadius * Math.cos(latRad) * Math.cos(lonRad);
            const z = earthRadius * Math.cos(latRad) * Math.sin(lonRad);
            const y = earthRadius * Math.sin(latRad);

            object.position.set(x, y, z);
        }

        document.getElementById("startAR").addEventListener("click", initAR);
    </script>
</body>
</html>
